<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>秦皇岛市智慧交通北斗大数据分析平台</title>
<link href="css/animate.min.css" rel="stylesheet" type="text/css">
<link href="css/layout.css" rel="stylesheet" type="text/css" />
<link href="css/bootstrap.min.css" rel="stylesheet">
<link href="font/iconfont.css" rel="stylesheet" type="text/css" />
<link href="css/layer-animate.css" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="css/datedropper.css">
<link rel="stylesheet" type="text/css" href="css/timedropper.min.css">
    <script src="js/tool.js"></script>
</head>

<body>

<div class="top" >
    <div class="top_r">
        <div class="time">
				<!--<input type="text" class="input_rl " id="pickdate" style="width:150px; height: 48px; margin-right: 10px; " />-->
				<span id=localtime></span>
                <script type="text/javascript">
					function showLocale(objD){
						var str,colorhead,colorfoot;
						var yy = objD.getYear();
						if(yy<1900) yy = yy+1900;
						var MM = objD.getMonth()+1;
						if(MM<10) MM = '0' + MM;
						var dd = objD.getDate();
						if(dd<10) dd = '0' + dd;
						var hh = objD.getHours();
						if(hh<10) hh = '0' + hh;
						var mm = objD.getMinutes();
						if(mm<10) mm = '0' + mm;
						var ss = objD.getSeconds();
						if(ss<10) ss = '0' + ss;
						var ww = objD.getDay();
						if  ( ww==0 )  colorhead="<font color=\"#35afbd\">";
						if  ( ww > 0 && ww < 6 )  colorhead="<font color=\"#35afbd\">";
						if  ( ww==6 )  colorhead="<font color=\"#35afbd\">";
						if  (ww==0)  ww="星期日";
						if  (ww==1)  ww="星期一";
						if  (ww==2)  ww="星期二";
						if  (ww==3)  ww="星期三";
						if  (ww==4)  ww="星期四";
						if  (ww==5)  ww="星期五";
						if  (ww==6)  ww="星期六";
						colorfoot="</font>"
						str = colorhead + yy + "-" + MM + "-" + dd + " " + hh + ":" + mm + ":" + ss + "  " + ww + colorfoot;
						return(str);
					}
					
					function tick(){
						var today;
						today = new Date();
						document.getElementById("localtime").innerHTML = showLocale(today);
						window.setTimeout("tick()", 1000);
					}
					
					tick();
					</script>	
        </div>
    </div>
    <div class="top_l">
    
        <div class="bt">
             <div class="bt_name left">高级检索</div>
             <a href="shouye.html" class="fanhui"><i class="iconfont icon-fanhui"></i></a>
        </div>
      
    </div>

    <div class="top_m "><div class="logo" onclick="goShouYe();"style="cursor:pointer">秦皇岛市智慧交通北斗大数据分析平台</div></div>
</div>












<div class="main">
      <div class="ind">
          <div class="blank40"></div>          
          <div class="mk " style="width:20%; height:900px; float:left">
               <em class="b1"></em><em class="b2"></em><em class="b3"></em><em class="b4"></em><em class="mid"></em>
               <div class="blank20"></div>
               <div class="tit">
                     <span class="tit_l"></span>
                     <span class="tit_m">高级检索</span>
                     <span class="tit_r"></span>
               </div>
                <form id="carInfoForm" action="" method="post">
                   <div class="con0 clearfix">
                        <input type="hidden" name="queryObj.cityId" value="130300"/>
                        <div class="mingcheng0">车牌号</div>
                        <div>
                            <input id="carPlateNum" class="input" name="queryObj.carPlateNum" type="text" />
                        </div>
                        <div class="blank10"></div>
                        <div class="mingcheng0">企业名称</div>
                        <div>
                            <input id="ownerTeamName" class="input" name="queryObj.ownerTeamName" type="text" />
                        </div>
                        <div class="blank10"></div>
                        <div class="mingcheng0">企业类型</div>
                        <div>
                            <select id="companyLavel" name="companyLavel" class="input00" style="height: 50px;">
                                <option class="lsd" value ="">请选择</option>
                                <option class="lsd" value ="TEAM_WXHWYS">危货</option>
                                <option class="lsd" value="TEAM_KY">客运</option>
                                <option class="lsd" value="TEAM_PTHW">普货</option>
                            </select>
                        </div>
                       <div class="blank10"></div>
                       <div class="mingcheng0">县区</div>
                       <div>
                           <select id="xianquId" name="queryObj.xianquId" class="input00" style="height: 50px;">
                               <option class="lsd" value ="">请选择</option>
                               <option class="lsd" value ="130302">海港区</option>
                               <option class="lsd" value="130303">山海关区</option>
                               <option class="lsd" value="130304">北戴河区</option>
                               <option class="lsd" value="130306">抚宁区</option>
                               <option class="lsd" value="130321">青龙县</option>
                               <option class="lsd" value="130322">昌黎县</option>
                               <option class="lsd" value="130324">卢龙县</option>
                               <option class="lsd" value="130371">开发区</option>
                           </select>
                       </div>
                        <div class="blank10"></div>
                        <div class="mingcheng0">联系人</div>
                        <div>
                            <input id="ownerName" class="input" name="queryObj.ownerName" type="text" />
                        </div>
                        <div class="mingcheng0">车架号</div>
                        <div>
                            <input id="carFrameNum" class="input" name="queryObj.carFrameNum" type="text" />
                        </div>
                        <div class="mingcheng0">手机号</div>
                        <div>
                            <input id="ownerPhoneNum" class="input" name="queryObj.ownerPhoneNum" type="text" />
                        </div>
                        <!--<div class="mingcheng0">技术档案编号</div>
                        <div>
                            <input id="carRecFileCode" class="input" name="queryObj.carRecFileCode" type="text" />
                        </div>-->
                        <div class="blank20"></div>
                        <div class="center">
                          <a href="javascript:void(0);" onclick="searchCarInfo();" class="clss"><i class="iconfont icon-sousuo5 " style="font-size:20px"></i>&nbsp;搜索</a>
                        </div>
                   </div>
                </form>
           </div> 
          
          
          
          <div class="mk " style="width:79%; height:900px; float:right">
               <em class="b1"></em><em class="b2"></em><em class="b3"></em><em class="b4"></em>
               <div class="blank20"></div>
               <div class="con0 clearfix">
                   <div  style="height:850px; overflow-y: auto">
                              <table id="carList" width="100%" class="grid06">
                                  <tr>
                                    <th style="width:10%">车牌号</th>
                                      <th style="width:10%">所属县区</th>
                                    <th style="width:20%">车架号</th>
                                    <th style="width:10%">车牌颜色</th>
                                    <th style="width:20%">车队名</th>
                                    <th style="width:10%">联系人</th>
                                    <th style="width:10%">联系电话</th>
                                    <th style="width:10%">技术档案编号</th>
                                  </tr>
                               </table>
                       
                              <div class="blank20"></div>
                       
                       
                             <div id="pageList" class="green-black">
                                    <!--<span class="disabled">&lt; Prev</span>
                                    <span class="current">1</span>
                                    <a href="#?page=2">2</a>
                                    <a href="#?page=3">3</a>
                                    <a href="#?page=4">4</a>
                                    <a href="#?page=5">5</a>
                                    <a href="#?page=6">6</a>
                                    <a href="#?page=7">7</a><em class="white">......</em>
                                    <a href="#?page=199">199</a>
                                    <a href="#?page=200">200</a>
                                    <a href="#?page=2">Next 
                                    &gt; </a>-->
                            </div> 
                       
                       
                             
                    </div>
                </div>
          </div>
         
           
     </div>
</div>









<script src="js/jquery-1.8.3.min.js"></script>
<script src="js/jquery-migrate-1.2.1.min.js"></script>
<script src="js/echarts.min.js"></script>
<script src="js/tool.js"></script>
<script type="text/javascript" src="js/jquery.min.js"></script>
<script type="text/javascript" src="js/bootstrap.min.js"></script>



<script src="js/datedropper.min.js"></script>
<script src="js/timedropper.min.js"></script>
<script>
$("#pickdate").dateDropper({
	animate: false,
	format: 'Y-m-d',
	maxYear: '2020'
});

$(function(){
    var queryArgs = getQueryParam();
    //查询多条数据
    searchCarList(queryArgs);
});

function searchCarList(queryArgs){
    var carPlateNum = decodeURI(queryArgs['queryObj.carPlateNum']);
    var xianquId = decodeURI(queryArgs['queryObj.xianquId']);
    var ownerTeamName = decodeURI(queryArgs['queryObj.ownerTeamName']);
    var companyLavel = decodeURI(queryArgs['companyLavel']);
    var page = decodeURI(queryArgs['page']);
    var param = "cityId=130300";
    var paramObj = "queryObj.cityId=130300";

    if(xianquId != "undefined" && xianquId != null && xianquId != ''){
        $("#xianquId").val(xianquId);
        param += "&xianquId="+xianquId;
        paramObj += "&queryObj.xianquId="+xianquId;
    }

    if(carPlateNum != "undefined" && carPlateNum != null && carPlateNum != ''){
        $("#carPlateNum").val(carPlateNum);
        param += "&carPlateNum="+carPlateNum;
        paramObj += "&queryObj.carPlateNum="+carPlateNum;
    }
    if(ownerTeamName != "undefined" && ownerTeamName != null && ownerTeamName != ''){
        $("#ownerTeamName").val(ownerTeamName);
        param += "&ownerTeamName="+ownerTeamName;
        paramObj += "&queryObj.ownerTeamName="+ownerTeamName;
    }
    if(companyLavel != "undefined" && companyLavel != null && companyLavel != ''){
        $("#companyLavel").val(companyLavel);
        param += "&companyLavel="+companyLavel;
        paramObj += "&companyLavel="+companyLavel;
    }
    var contactPerson = decodeURI(queryArgs['queryObj.ownerName']);
    if(contactPerson != "undefined" && contactPerson != ""){
        $("#ownerName").val(contactPerson);
        param += "&contactPerson="+contactPerson;
        paramObj += "&queryObj.ownerName="+contactPerson;
    }
    var carFrameNum = decodeURI(queryArgs['queryObj.carFrameNum']);
    if(carFrameNum != "undefined" && carFrameNum != ""){
        $("#carFrameNum").val(carFrameNum);
        param += "&carFrameNum="+carFrameNum;
        paramObj += "&queryObj.carFrameNum="+carFrameNum;
    }
    var contactPhone = decodeURI(queryArgs['queryObj.ownerPhoneNum']);
    if(contactPhone != "undefined" && contactPhone != ""){
        $("#ownerPhoneNum").val(contactPhone);
        param += "&contactPhone="+contactPhone;
        paramObj += "&queryObj.ownerPhoneNum="+contactPhone;
    }
    var carRecFileCode = decodeURI(queryArgs['queryObj.carRecFileCode']);
    if(carRecFileCode != "undefined" && carRecFileCode != ""){
        $("#carRecFileCode").val(carRecFileCode);
        param += "&carRecFileCode="+carRecFileCode;
        paramObj += "&queryObj.carRecFileCode="+carRecFileCode;
    }
    if(page != "undefined" && page != null && page != ''){
        param += "&page="+page+"&limit=13";
        paramObj += "&page="+page+"&limit=13";
    }

    $.ajax({
      type:'POST',
      url: basePathUrl + '/admin/carInfo/carinfoByQuery.jsn',
      data:paramObj,
        beforeSend: function (XMLHttpRequest) {
            XMLHttpRequest.setRequestHeader("access-token", getStorage("access_token"));
        },
      success:function(data){
          if(data.success){
            var carList = data.list;
            var html = "";
            if(carList.length > 0){
                for(var i=0;i<carList.length;i++){
                    html += "<tr style='cursor: pointer' onclick=gotoDetailPage('"+carList[i].id+"')>";
                    html += "<td>"+carList[i].carPlateNum+"</td>";
                    if(typeof (carList[i].xianquName)=='undefined'){
                        html += "<td>暂无</td>";
                    }else {
                        html += "<td>"+carList[i].xianquName+"</td>";
                    }
                    html += "<td>"+carList[i].carFrameNum+"</td>";
                    html += "<td>"+carList[i].carPlateColor+"</td>";
                    if(carList[i].ownerCarTeamName != null){
                        html += "<td>"+carList[i].ownerCarTeamName+"</td>";
                    }else{
                        html += "<td></td>";
                    }
                    if(carList[i].contactPerson != null){
                        html += "<td>"+carList[i].contactPerson+"</td>";
                    }else{
                        html += "<td></td>";
                    }
                    if(carList[i].contactPhone != null){
                        html += "<td>"+carList[i].contactPhone+"</td>";
                    }else{
                        html += "<td></td>";
                    }
                    if(carList[i].carRecFileCode != null){
                        html += "<td>"+carList[i].carRecFileCode+"</td>";
                    }else{
                        html += "<td></td>";
                    }
                    html += "</tr>";
                }
                debugger;
                setPageInfo(data.totalPage,data.start,data.limit,data.totalCount);
            }else{
                html += "<tr><td colspan='7'>暂无信息</td></tr>";
            }
            $("#carList").html($("#carList").html() + html);
          }else {
              if(data.code==1001){
                  location.href = '../../login.html';
              }else {
                  /*layer.msg('后台异常', {
                      icon: 5
                  });*/
              }
          }
      }
    });
}

function gotoDetailPage(id){
    window.location.href = "yingYunCheLiang.html?queryObj.id="+id;
}

function searchCarInfo(){
    debugger;
    var param = $("#carInfoForm").serialize();
    $.ajax({
        type:'POST',
        url: basePathUrl + '/admin/bigdatadata/countCarInfoByQuery.jsn',
        data:param,
        dataType:'json',
        beforeSend: function (XMLHttpRequest) {
            XMLHttpRequest.setRequestHeader("access-token", getStorage("access_token"));
        },
        success:function(data){
            debugger;
            if(data.success){
                if(data.data > 0){
                    if(data.data == 1){
                        window.location.href = "yingYunCheLiang.html?"+param;
                    }else{
                        window.location.href = "gaoJiJianSuo.html?"+param;
                    }
                }else{
                    alert("未查询到车辆信息");
                }
            }else {
                if(data.code==1001){
                    location.href = '../../login.html';
                }else {
                    layer.msg('后台异常', {
                        icon: 5
                    });
                }
            }
        }
    });
}

function setPageInfo(totalPage,start,limit,totalCount){
    debugger
    var page = 0;
    if(limit != 0){
        page = start/limit;
    }
    var pageHtml = "";
    var showPageCount = page + 5;
    pageHtml += "<a href='javaScript:void(0);' onclick=sendRequest('prev',"+(page+1)+","+totalPage+")>&lt;上一页</a>";
    if(page>0){
        pageHtml += "<a href='javaScript:void(0);' onclick=sendRequest('',"+(1)+","+totalPage+")>首页</a>";
    }
    for(var i=page;i<totalPage;i++){
        if(i < showPageCount){
            if(i == page){
                pageHtml += "<a href='javaScript:void(0);' style='background-color: #E07C24;border: none'  onclick=sendRequest('',"+(i+1)+","+totalPage+")>"+(i+1)+"</a>";
            }else{
                pageHtml += "<a href='javaScript:void(0);' onclick=sendRequest('',"+(i+1)+","+totalPage+")>"+(i+1)+"</a>";
            }
        }else{
            if(i == showPageCount){
                pageHtml += "<em class='white'>......</em>";
                pageHtml += "<a href='javaScript:void(0);' onclick=sendRequest('',"+totalPage+","+totalPage+")>"+totalPage+"</a>";
            }
        }
    }
    pageHtml += "<a href='javaScript:void(0);' onclick=sendRequest('next',"+(page+1)+","+totalPage+")>下一页 &gt;</a>";
    pageHtml += "<a href='javaScript:void(0);'>总数："+totalCount+"</a>";
    $("#pageList").html(pageHtml);
}

function sendRequest(pageFlag,page,totalPage){
    debugger;
    if(pageFlag == "next"){
        page++;
    }else{
        if(pageFlag == "prev"){
            page--;
        }
    }

    if(page > 0 && page <= totalPage){
        var url = document.URL;
        var checkUrl = url.split("?");
        if(checkUrl.length>1){
            var urlArr = url.split("&page");
            var sendUrl = urlArr[0] + "&page="+page
            window.location.href = sendUrl;
        }else{
            var urlArr = url.split("?page");
            var sendUrl = urlArr[0] + "?page="+page
            window.location.href = sendUrl;
        }
    }
}

function goShouYe() {
    window.location.href = "shouye.html";
}

</script>   
  
</body>
</html>
