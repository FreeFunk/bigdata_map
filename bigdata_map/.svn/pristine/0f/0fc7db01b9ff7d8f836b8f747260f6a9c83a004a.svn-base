<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>秦皇岛市智慧交通北斗大数据分析平台</title>
    <link href="css/animate.min.css" rel="stylesheet" type="text/css">
    <link href="css/layout.css" rel="stylesheet" type="text/css" />
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="font/iconfont.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" type="text/css" href="css/datedropper.css">
    <link rel="stylesheet" type="text/css" href="css/timedropper.min.css">
    <script src="js/tool.js"></script>
    <script src="js/layer/layer.js"></script>
    <script type="text/javascript" src="js/laydate/laydate.js"></script>
    <script src="js/echarts.min.js"></script>
    <style type="text/css">
        .el-radio-button__inner {
            line-height: 1;
            white-space: nowrap;
            vertical-align: middle;
            background: #00000000;
            border: 1px solid #1f6794;
            font-weight: 500;
            border-left: 0;
            color: #77eaff;
            -webkit-appearance: none;
            text-align: center;
            box-sizing: border-box;
            margin: 0;
            cursor: pointer;
            transition: all .3s cubic-bezier(.645,.045,.355,1);
            padding: 12px 20px;
            font-size: 14px;
            border-radius: 0;
        }
        .el-radio-button, .el-radio-button__inner {
            display: inline-block;
            position: relative;
            outline: 0;
        }
        .el-radio-button--medium .el-radio-button__inner {
            padding: 10px 20px;
            font-size: 14px;
            border-radius: 0;
        }
        .el-radio-button:first-child .el-radio-button__inner {
            border-left: 1px solid #1f6794;
            border-radius: 4px 0 0 4px;
            box-shadow: none!important;
        }
        .el-radio-button__orig-radio {
            opacity: 0;
            outline: 0;
            position: absolute;
            z-index: -1;
        }
        .el-radio-button, .el-radio-button__inner {
            display: inline-block;
            position: relative;
            outline: 0;
        }
        .el-radio-group {
            display: inline-block;
            line-height: 1;
            vertical-align: middle;
            font-size: 0;
        }
        .el-row {
            box-sizing: border-box;
        }

        .tab0 .nav-tabs0{
            padding-left: 15px;
            border-bottom: 4px solid #026C9C;
        }
        .tab0 .nav-tabs0 li a{
            color: #fff;
            padding: 8px 40px;
            margin-right: 10px;
            background: #026C9C;
            text-shadow: 1px 1px 2px #000;
            border: none;
            float: left;
            border-radius: 0;
            opacity: 0.5;
            position: relative;
            transition: all 0.3s ease 0s;
        }
        .tab0 .nav-tabs0 li a:hover{
            background: #026C9C;
            opacity: 0.8;
        }
        .tab0 .nav-tabs0 li.active a{
            opacity: 1;
        }
        .tab0 .nav-tabs0 li.active a,
        .tab0 .nav-tabs0 li.active a:hover,
        .tab0 .nav-tabs0 li.active a:focus{
            color: #fff;
            background: #026C9C;
            border: none;
            border-radius: 0;
        }
        .tab0 .nav-tabs0 li a:before,
        .tab0 .nav-tabs0 li a:after{
            content: "";
            border-top: 42px solid transparent;
            position: absolute;
            top: -2px;
        }
        .tab0 .nav-tabs0 li a:before{
            border-right: 15px solid #026C9C;
            left: -15px;
        }
        .tab0 .nav-tabs0 li a:after{
            border-left: 15px solid #026C9C;
            right: -15px;
        }
        .tab0 .nav-tabs0 li a i,
        .tab0 .nav-tabs0 li.active a i{
            display: inline-block;
            padding-right: 5px;
            font-size: 17px;
            text-shadow: none;
        }
        .tab0 .nav-tabs0 li a span{
            display: inline-block;
            font-size: 17px;
            letter-spacing: -3px;

            transition: all 0.3s ease 0s;
        }
        .tab0 .nav-tabs0 li a:hover span,
        .tab0 .nav-tabs0 li.active a span{
            letter-spacing: 5px;
            opacity: 1;
            transition: all 0.3s ease 0s;
        }
        .tab0 .tab-content0{
            padding: 30px;
            background: #fff;
            font-size: 16px;
            color: #6c6c6c;
            line-height: 25px;
        }
        .tab0 .tab-content0 h3{
            font-size: 24px;
            margin-top: 0;
        }
        .chaxun1 { padding:14px 47px !important;margin-left:4.5%;margin-top:1.6%;border-radius:3px;box-shadow:rgb(50, 151, 207) 0px 0px 38px inset; color:#77eaff!important; font-size:19px !important; border:1px solid #52d5ff !important; text-decoration:none}
        .chaxun1:hover{box-shadow:rgb(226, 120, 78) 0px 0px 38px inset; border:1px solid #ffdab5 !important; color:#fffffd !important; text-decoration:none}

        .btn000Selected{box-shadow:rgb(226, 120, 78) 0px 0px 38px inset; border:1px solid #ffdab5 !important; color:#fffffd !important; text-decoration:none}

        @media only screen and (max-width: 479px){
            .tab0 .nav-tabs0 li{
                width: 100%;
                margin-bottom: 5px;
                text-align: center;
            }
            .tab0 .nav-tabs0 li a span{
                letter-spacing: 1px;
                opacity: 1;
            }
        }
    </style>
</head>

<body>

<div class="top" >
    <div class="top_r">
        <div class="time">
            <!--<input type="text" class="input_rl " id="pickdate" style="width:150px; height: 48px; margin-right: 10px; " /> -->
            <span id=localtime></span>
            <script type="text/javascript">
                function showLocale(objD){
                    var str,colorhead,colorfoot;
                    var yy = objD.getYear();
                    if(yy<1900) yy = yy+1900;
                    var MM = objD.getMonth()+1;
                    if(MM<10) MM = '0' + MM;
                    var dd = objD.getDate();
                    if(dd<10) dd = '0' + dd;
                    var hh = objD.getHours();
                    if(hh<10) hh = '0' + hh;
                    var mm = objD.getMinutes();
                    if(mm<10) mm = '0' + mm;
                    var ss = objD.getSeconds();
                    if(ss<10) ss = '0' + ss;
                    var ww = objD.getDay();
                    if  ( ww==0 )  colorhead="<font color=\"#35afbd\">";
                    if  ( ww > 0 && ww < 6 )  colorhead="<font color=\"#35afbd\">";
                    if  ( ww==6 )  colorhead="<font color=\"#35afbd\">";
                    if  (ww==0)  ww="星期日";
                    if  (ww==1)  ww="星期一";
                    if  (ww==2)  ww="星期二";
                    if  (ww==3)  ww="星期三";
                    if  (ww==4)  ww="星期四";
                    if  (ww==5)  ww="星期五";
                    if  (ww==6)  ww="星期六";
                    colorfoot="</font>"
                    str = colorhead + yy + "-" + MM + "-" + dd + " " + hh + ":" + mm + ":" + ss + "  " + ww + colorfoot;
                    return(str);
                }

                function tick(){
                    var today;
                    today = new Date();
                    document.getElementById("localtime").innerHTML = showLocale(today);
                    window.setTimeout("tick()", 1000);
                }

                tick();
            </script>
        </div>
    </div>
    <div class="top_l">

        <div class="bt">
            <div class="bt_name left">车辆分析</div>
            <a href="javascript:history.back(-1)" class="fanhui"><i class="iconfont icon-fanhui"></i></a>
        </div>

    </div>

    <div class="top_m "><div class="logo" onclick="goShouYe();"style="cursor:pointer">秦皇岛市智慧交通北斗大数据分析平台</div></div>
</div>

<div class="main">
    <div class="ind mt60" style="height: 930px;overflow-y: scroll">
        <div style="width: 100%;height: 320px;">
            <!-- 车辆安全月报 9月 -->
            <div class="mk " style="width:40%; height:350px;float: left;">
                <em class="b1"></em><em class="b2"></em><em class="b3"></em><em class="b4"></em>
                <div class="blank20"></div>
                <div class="con0 clearfix">
                    <div  style="height:350px;width: 65%; overflow-y: auto;float: left;">
                        <h4 style="font-weight: bolder;color: #77eaff">车辆安全月报（<label id="searchTimeName"></label>）</h4>
                        <hr style="width: 80%;margin-left: 0px;">
                        <h4 id="carPlateNum" style="font-weight: bolder;color: #77eaff">冀C0192H</h4>
                        <h4 id="teamName" style="font-weight: bolder;color: #77eaff">公司或车队的名称</h4>
                        <h4 id="xianquTransitType" style="color: #77eaff">公司或车队的名称/车辆运输类型</h4>
                        <h4 style="color: #77eaff">车辆排名：<label id="carRanking"></label></h4>
                        <h4 style="color: #77eaff">统计周期：<label id="countDate"></label></h4>
                        <h4 style="color: #77eaff">行驶里程：<label id="runMileage"></label></h4>
                        <h4 style="color: #77eaff">行驶时长：<label id="runTimeLength"></label></h4>
                        <h4 style="color: #77eaff">报警次数：<label id="alarmNum"></label></h4>
                    </div>
                    <div style="width: 35%;height: 350px;float: left;">
                        <h4 style="font-weight: bolder;color: #77eaff;margin-top: 90px;">安全评分：<label style="font-size: 80px;" id="safeScore">99</label></h4>
                    </div>
                </div>
            </div>

            <!-- 汇总分析 -->
            <div class="mk" style="width: 58%;height: 350px;float: left;margin-left: 2%;">
                <em class="b1"></em><em class="b2"></em><em class="b3"></em><em class="b4"></em>
                <div class="blank20"></div>
                <div class="con0 clearfix">
                    <h4 style="font-weight: bolder;color: #77eaff">汇总分析</h4>
                    <div id="compareWithTeam" style="width: 50%;height: 300px;float: left;"></div>

                    <div id="gatherAnaly" style="width: 50%;height: 300px;float: left;"></div>
                </div>
            </div>
        </div>

        <div style="width: 100%;height: 350px;margin-top: 50px;">
            <!-- 行驶里程 -->
            <div class="mk" style="width: 49%;height: 330px;float: left;">
                <em class="b1"></em><em class="b2"></em><em class="b3"></em><em class="b4"></em>
                <div class="blank20"></div>
                <div class="con0 clearfix">
                    <h4 style="font-weight: bolder;color: #77eaff">行驶里程（单位：千米）</h4>
                    <div id="runMileageChart" style="width: 100%;height: 280px;"></div>
                </div>
            </div>

            <!-- 行驶时长 -->
            <div class="mk" style="width: 49%;height: 330px;float: left;margin-left: 2%">
                <em class="b1"></em><em class="b2"></em><em class="b3"></em><em class="b4"></em>
                <div class="blank20"></div>
                <div class="con0 clearfix">
                    <h4 style="font-weight: bolder;color: #77eaff">行驶时长（单位：小时）</h4>
                    <div id="runTimeChart" style="width: 100%;height: 280px;"></div>
                </div>
            </div>
        </div>

        <div style="width: 100%;height: 350px;">
            <!-- 报警统计 -->
            <div class="mk" style="width: 49%;height: 330px;float: left;">
                <em class="b1"></em><em class="b2"></em><em class="b3"></em><em class="b4"></em>
                <div class="blank20"></div>
                <div class="con0 clearfix">
                    <h4 style="font-weight: bolder;color: #77eaff">报警统计（单位：次）</h4>
                    <div id="alarmChart" style="width: 100%;height: 280px;"></div>
                </div>
            </div>

            <div class="mk" style="width: 49%;height: 330px;float: left;margin-left: 2%;">
                <em class="b1"></em><em class="b2"></em><em class="b3"></em><em class="b4"></em>
                <div class="blank20"></div>
                <div class="con0 clearfix">
                    <h4 style="font-weight: bolder;color: #77eaff">数据</h4>
                    <table style="width: 90%;margin-left: 5%;" class="grid06">
                        <tr>
                            <th width="33%">报警类型</th>
                            <th width="33%">报警数量</th>
                            <th width="34%">平均每百公里数量</th>
                        </tr>
                    </table>
                    <div style="width: 100%;height: 200px;overflow-y: scroll;">
                        <table id="alarmTable" style="width: 90%; margin-left: 5%;" class="grid06">

                        </table>
                    </div>

                </div>
            </div>
        </div>


    </div>
</div>


<script src="js/jquery-1.8.3.min.js"></script>
<script src="js/jquery-migrate-1.2.1.min.js"></script>
<script src="js/echarts.min.js"></script>
<script src="js/datedropper.min.js"></script>
<script src="js/timedropper.min.js"></script>
<script>
    var xDateArr = new Array();
    var compareCarArr = new Array();
    var compareTeamArr = new Array();
    var alarmTypeArr = new Array();
    var alarmNumArr = new Array();
    var carMileageArr = new Array();
    var carTimeLengthArr = new Array();
    var carAlarmNumArr = new Array();
    var teamMileageArr = new Array();
    var teamTimeLengthArr = new Array();
    var teamAlarmNumArr = new Array();

    //初始化查询条件和信息
    $(document).ready(function(){
        var queryArgs = getQueryParam();

        var searchType = queryArgs.searchType;
        var yearNum = queryArgs.yearNum;
        var ownerCarDayId = queryArgs.ownerCarDayId;
        var param = '';
        if(searchType == 'week'){
            var weekCountStr = queryArgs.weekCountStr;
            param = "queryObj.yearNum="+yearNum+"&queryObj.weekCountStr="+weekCountStr;
            searchCarFenXiDetail(param,searchType,ownerCarDayId);
        }else{
            var countMonth = queryArgs.countMonth;
            param = "queryObj.yearNum="+yearNum+"&queryObj.countMonth="+countMonth;
            searchCarFenXiDetail(param,searchType,ownerCarDayId);
        }
    })

    //根据条件查询详细信息
    function searchCarFenXiDetail(paramMap,searchType,ownerCarDayId){
        if(searchType == 'week'){
            var param = paramMap + "&queryObj.id="+ownerCarDayId;
            $.ajax({
                type: 'POST',
                url: basePathUrl + '/admin/bigdataFenxiCarWeek/selectCarWeekAndTeamWeek.jsn',
                data: param,
                dataType: 'json',
                beforeSend: function (XMLHttpRequest) {
                    XMLHttpRequest.setRequestHeader("access-token", getStorage("access_token"));
                },
                success: function(res){
                    if(res.success){
                        var fenxiCarWeek = res.data.carWeek;
                        var fenxiTeamWeek = res.data.teamWeek;

                        //设置标识显示
                        $("#searchTimeName").html("第"+fenxiCarWeek.countWeek+"周");

                        //设置车辆安全月报数据
                        $("#carPlateNum").html(fenxiCarWeek.carPlateNum);
                        $("#teamName").html(fenxiCarWeek.ownerTeamName);
                        if(typeof(fenxiCarWeek.transitType) == 'undefined'){
                            $("#xianquTransitType").html(fenxiCarWeek.provinceName+fenxiCarWeek.cityName+fenxiCarWeek.xianquName+" / ");
                        }else{
                            $("#xianquTransitType").html(fenxiCarWeek.provinceName+fenxiCarWeek.cityName+fenxiCarWeek.xianquName+" / "+fenxiCarWeek.transitType);
                        }
                        $("#carRanking").html(fenxiCarWeek.carRanking);
                        $("#countDate").html(dateFormat('yyyy-MM-dd',new Date(fenxiCarWeek.startCountDate))+" / "+dateFormat('yyyy-MM-dd',new Date(fenxiCarWeek.endCountDate)));
                        $("#runMileage").html(fenxiCarWeek.runMileage);
                        $("#runTimeLength").html(fenxiCarWeek.runTimeLength);
                        $("#alarmNum").html(fenxiCarWeek.alarmNum);
                        $("#safeScore").html(fenxiCarWeek.safeScore);
                        debugger;
                        //设置汇总柱状图数据（车辆）
                        compareCarArr[0] = -fenxiCarWeek.alarmRate;
                        compareCarArr[1] = -fenxiCarWeek.alarmNum;
                        compareCarArr[2] = -fenxiCarWeek.runTimeLength;
                        compareCarArr[3] = -fenxiCarWeek.runMileage;
                        //设置汇总柱状图数据（企业）
                        if(typeof(fenxiTeamWeek) == 'undefined'){
                            compareTeamArr[0] = 0;
                            compareTeamArr[1] = 0;
                            compareTeamArr[2] = 0;
                            compareTeamArr[3] = 0;
                        }else{
                            compareTeamArr[0] = fenxiTeamWeek.alarmRate;
                            compareTeamArr[1] = fenxiTeamWeek.alarmNum;
                            compareTeamArr[2] = fenxiTeamWeek.runTimeLength;
                            compareTeamArr[3] = fenxiTeamWeek.runMileage;
                        }

                        //设置企业和车辆柱状图
                        setCarAndTeamZzt();
                        //设置报警类型饼状图和列表
                        param = paramMap + '&queryObj.ownerCarDayId='+ownerCarDayId;
                        setAlarmType(param);
                        //设置企业和车辆每天的数据
                        param = paramMap + "&queryObj.startCountDate="+fenxiCarWeek.startCountDate+"&queryObj.endCountDate="+fenxiCarWeek.endCountDate;
                        param += "&queryObj.carFrameNum="+fenxiCarWeek.carFrameNum+"&queryObj.ownerTeamId="+fenxiCarWeek.ownerTeamId;
                        setCarTeamDay(param,fenxiCarWeek.startCountDate);
                    }else if(res.code = 1001){
                        location.href = "../../login.html";
                    }else{
                        layer.msg('后台异常',{
                            icon: 5
                        })
                    }
                }
            })
        }else{
            var param = paramMap + "&queryObj.id="+ownerCarDayId;
            $.ajax({
                type: 'POST',
                url: basePathUrl + '/admin/bigdataFenxiCarMonth/selectCarAndTeamMonth.jsn',
                data: param,
                dataType: 'json',
                beforeSend: function (XMLHttpRequest) {
                    XMLHttpRequest.setRequestHeader("access-token", getStorage("access_token"));
                },
                success: function(res){
                    if(res.success){
                        var fenxiCarMonth = res.data.carMonth;
                        var teamMonth = res.data.teamMonth;
                        var yearNum = fenxiCarMonth.yearNum;
                        var countMonth = fenxiCarMonth.countMonth+"";
                        var countMonthArr = countMonth.split(yearNum+"");
                        var monthInt = parseInt(countMonthArr[1]);

                        //设置标识显示
                        $("#searchTimeName").html(monthInt+"月");

                        //设置车辆安全月报数据
                        $("#carPlateNum").html(fenxiCarMonth.carPlateNum);
                        $("#teamName").html(fenxiCarMonth.ownerTeamName);
                        if(typeof(fenxiCarMonth.transitType) == 'undefined'){
                            $("#xianquTransitType").html(fenxiCarMonth.provinceName+fenxiCarMonth.cityName+fenxiCarMonth.xianquName+" / ");
                        }else{
                            $("#xianquTransitType").html(fenxiCarMonth.provinceName+fenxiCarMonth.cityName+fenxiCarMonth.xianquName+" / "+fenxiCarMonth.transitType);
                        }
                        $("#carRanking").html(fenxiCarMonth.carRanking);
                        $("#countDate").html(dateFormat('yyyy-MM-dd',new Date(yearNum,monthInt-1,1))+" / "+dateFormat('yyyy-MM-dd',new Date(yearNum,monthInt,0)));
                        $("#runMileage").html(fenxiCarMonth.runMileage);
                        $("#runTimeLength").html(fenxiCarMonth.runTimeLength);
                        $("#alarmNum").html(fenxiCarMonth.alarmNum);
                        $("#safeScore").html(fenxiCarMonth.safeScore);
                        //设置汇总柱状图数据（车辆）
                        compareCarArr[0] = -fenxiCarMonth.alarmRate;
                        compareCarArr[1] = -fenxiCarMonth.runTimeLength;
                        compareCarArr[2] = -fenxiCarMonth.alarmNum;
                        compareCarArr[3] = -fenxiCarMonth.runMileage;
                        //设置汇总柱状图数据（企业）
                        if(typeof(teamMonth) == 'undefined'){
                            compareTeamArr[0] = 0;
                            compareTeamArr[1] = 0;
                            compareTeamArr[2] = 0;
                            compareTeamArr[3] = 0;
                        }else{
                            compareTeamArr[0] = teamMonth.alarmRate;
                            compareTeamArr[1] = teamMonth.runTimeLength;
                            compareTeamArr[2] = teamMonth.alarmNum;
                            compareTeamArr[3] = teamMonth.runMileage;
                        }


                        //设置企业和车辆柱状图
                        setCarAndTeamZzt();
                        //设置报警类型饼状图和列表 月份
                        param = paramMap + "&queryObj.ownerCarMonthId="+ownerCarDayId;
                        setAlarmTypeMonth(param);
                        //设置企业和车辆每天的数据 月份
                        param = paramMap + "&queryObj.carFrameNum="+fenxiCarMonth.carFrameNum+"&queryObj.ownerTeamId="+fenxiCarMonth.ownerTeamId;
                        debugger;
                        setCarTeamDayMonth(param,fenxiCarMonth.yearNum,fenxiCarMonth.countMonth);
                    }else if(res.code = 1001){
                        location.href = "../../login.html";
                    }else{
                        layer.msg('后台异常',{
                            icon: 5
                        })
                    }
                }
            })
        }

    }

    //设置企业和车辆柱状图
    function setCarAndTeamZzt(){
        //汇总分析柱状图
        var hzChartZ = echarts.init(document.getElementById('compareWithTeam'));
        var hzOptionZ = {
            tooltip : {
                trigger: 'axis',
                formatter: function(params) {
                    var result = params[0].name + "<br>";
                    params.forEach(function(item) {
                        result += item.marker + " " + item.seriesName + " : " + Math.abs(item.value) + "</br>";
                    });
                    return result;
                },
                axisPointer : {            // 坐标轴指示器，坐标轴触发有效
                    type : 'shadow'        // 默认为直线，可选为：'line' | 'shadow'
                }
            },
            grid: {
                left: '3%',
                right: '4%',
                containLabel: true
            },
            xAxis : [
                {
                    splitLine: {show: false},
                    axisTick : {show: false},
                    axisLabel: {
                        show: false
                    }
                }
            ],
            yAxis : [
                {

                    axisTick : {show: false},
                    splitLine: {show: false},
                    axisLabel:{
                        show: true,
                        textStyle:{
                            color:'#77eaff'
                        }
                    },
                    label: {
                        normal: {
                            show: false
                        }
                    },
                    data : ['百公里报警数','报警数','时长','里程']
                }
            ],
            series : [
                {
                    name:'企业',
                    color: '#F9D858',
                    type:'bar',
                    stack: '总量',
                    label: {
                        normal: {
                            show: false,
                            position: 'left',
                            formatter:function(v){return Math.abs(v.data)}
                        }
                    },
                    data: compareTeamArr
                },
                {
                    name:'车辆',
                    color: '#D1FBEF',
                    type:'bar',
                    stack: '总量',
                    label: {
                        normal: {
                            show: false,
                            position: 'left',
                            formatter:function(v){return Math.abs(v.data)}
                        }
                    },
                    data: compareCarArr
                }
            ]
        };
        hzChartZ.setOption(hzOptionZ);
    }

    //设置报警类型相关列表
    function setAlarmType(param){
        $.ajax({
            type: 'POST',
            url: basePathUrl + '/admin/bigdataFenxiCarAlarmWeek/selectAlarmTypeByCarWeek.jsn',
            data: param,
            dataType: 'json',
            beforeSend: function (XMLHttpRequest) {
                XMLHttpRequest.setRequestHeader("access-token", getStorage("access_token"));
            },
            success:function (res) {
                if(res.success){
                    var carAlarmWeekList = res.list;
                    var alarmTableHtml = "";
                    if(carAlarmWeekList.length > 0){
                        for(var i=0;i<carAlarmWeekList.length;i++){
                            alarmTableHtml += "<tr>";
                            if(typeof(carAlarmWeekList[i].alarmType) == 'undefined'){
                                alarmTableHtml += "<td class='lsd' width='33%'></td>";
                            }else{
                                alarmTableHtml += "<td class='lsd' width='33%'>"+carAlarmWeekList[i].alarmTypeDesc+"</td>";
                            }
                            if(typeof(carAlarmWeekList[i].alarmNum) == 'undefined'){
                                alarmTableHtml += "<td class='lsd' width='33%'></td>";
                            }else{
                                alarmTableHtml += "<td class='lsd' width='33%'>"+carAlarmWeekList[i].alarmNum+"</td>";
                            }
                            if(typeof(carAlarmWeekList[i].alarmRate) == 'undefined'){
                                alarmTableHtml += "<td class='lsd' width='34%'></td>";
                            }else{
                                alarmTableHtml += "<td class='lsd' width='34%'>"+carAlarmWeekList[i].alarmRate+"</td>";
                            }
                            alarmTableHtml += "</tr>";
                            alarmTypeArr[i] = carAlarmWeekList[i].alarmTypeDesc;
                            alarmNumArr[i] = {'value':carAlarmWeekList[i].alarmNum,'name':carAlarmWeekList[i].alarmTypeDesc};
                        }
                    }else{
                        alarmTableHtml = "<tr><td colspan='3'>暂无数据</td></tr>";
                    }
                    //设置数据表格的数据
                    $("#alarmTable").html(alarmTableHtml);
                    //汇总分析饼状图
                    var hzChartB = echarts.init(document.getElementById('gatherAnaly'));
                    var hzOptionB = {
                        tooltip: {//提示框，可以在全局也可以在
                            trigger: 'item',  //提示框的样式
                            formatter: "({b}: {c} ({d}%)",
                            color:'#000', //提示框的背景色
                            textStyle:{ //提示的字体样式
                                color:"#77eaff",
                            }
                        },
                        legend: {  //图例
                            orient: 'vertical',  //图例的布局，竖直    horizontal为水平
                            x: 'right',//图例显示在右边
                            data: alarmTypeArr,
                            textStyle:{    //图例文字的样式
                                color:'#77eaff',  //文字颜色
                                fontSize:12    //文字大小
                            }
                        },
                        series: [
                            {
                                name:'汇总分析',
                                type:'pie', //环形图的type和饼图相同
                                radius: ['50%', '70%'],//饼图的半径，第一个为内半径，第二个为外半径
                                avoidLabelOverlap: false,
                                color:['#D1FBEF','#F9D858','#4CD0DD','#7FFFAA','#F08080','#FFA07A','#FFF68F','#FF8247','#FFBBFF','#FFFFFF','#CDB38B','#00FF00'],
                                label: {
                                    normal: {  //正常的样式
                                        show: true,
                                        position: 'left'
                                    },
                                    emphasis: { //选中时候的样式
                                        show: true,
                                        textStyle: {
                                            fontSize: '20',
                                            fontWeight: 'bold'
                                        }
                                    }
                                },  //提示文字
                                labelLine: {
                                    normal: {
                                        show: false
                                    }
                                },
                                data: alarmNumArr
                            }
                        ]
                    };
                    hzChartB.setOption(hzOptionB);
                }else if(res.code = 1001){
                    location.href = "../../login.html";
                }else{
                    layer.msg('后台异常',{
                        icon: 5
                    })
                }
            }
        })
    }

    //设置报警类型相关列表 月份
    function setAlarmTypeMonth(param){
        $.ajax({
            type: 'POST',
            url: basePathUrl + '/admin/bigdataFenxiCarAlarmMonth/selectCarAlarmTypeByCarWeek.jsn',
            data: param,
            dataType: 'json',
            beforeSend: function (XMLHttpRequest) {
                XMLHttpRequest.setRequestHeader("access-token", getStorage("access_token"));
            },
            success:function(res){
                if(res.success){
                    var carAlarmMonthList = res.list;
                    var alarmTableHtml = "";
                    if(carAlarmMonthList.length > 0){
                        for(var i=0;i<carAlarmMonthList.length;i++){
                            alarmTableHtml += "<tr>";
                            if(typeof(carAlarmMonthList[i].alarmType) == 'undefined'){
                                alarmTableHtml += "<td class='lsd' width='33%'></td>";
                            }else{
                                alarmTableHtml += "<td class='lsd' width='33%'>"+carAlarmMonthList[i].alarmTypeDesc+"</td>";
                            }
                            if(typeof(carAlarmMonthList[i].alarmNum) == 'undefined'){
                                alarmTableHtml += "<td class='lsd' width='33%'></td>";
                            }else{
                                alarmTableHtml += "<td class='lsd' width='33%'>"+carAlarmMonthList[i].alarmNum+"</td>";
                            }
                            if(typeof(carAlarmMonthList[i].alarmRate) == 'undefined'){
                                alarmTableHtml += "<td class='lsd' width='34%'></td>";
                            }else{
                                alarmTableHtml += "<td class='lsd' width='34%'>"+carAlarmMonthList[i].alarmRate+"</td>";
                            }
                            alarmTableHtml += "</tr>";
                            alarmTypeArr[i] = carAlarmMonthList[i].alarmTypeDesc;
                            alarmNumArr[i] = {'value':carAlarmMonthList[i].alarmNum,'name':carAlarmMonthList[i].alarmTypeDesc};
                        }
                    }else{
                        alarmTableHtml = "<tr><td colspan='3'>暂无数据</td></tr>";
                    }
                    //设置数据表格的数据
                    $("#alarmTable").html(alarmTableHtml);
                    //汇总分析饼状图
                    var hzChartB = echarts.init(document.getElementById('gatherAnaly'));
                    var hzOptionB = {
                        tooltip: {//提示框，可以在全局也可以在
                            trigger: 'item',  //提示框的样式
                            formatter: "({b}: {c} ({d}%)",
                            color:'#000', //提示框的背景色
                            textStyle:{ //提示的字体样式
                                color:"#77eaff",
                            }
                        },
                        legend: {  //图例
                            orient: 'vertical',  //图例的布局，竖直    horizontal为水平
                            x: 'right',//图例显示在右边
                            data: alarmTypeArr,
                            textStyle:{    //图例文字的样式
                                color:'#77eaff',  //文字颜色
                                fontSize:12    //文字大小
                            }
                        },
                        series: [
                            {
                                name:'汇总分析',
                                type:'pie', //环形图的type和饼图相同
                                radius: ['50%', '70%'],//饼图的半径，第一个为内半径，第二个为外半径
                                avoidLabelOverlap: false,
                                color:['#D1FBEF','#F9D858','#4CD0DD','#7FFFAA','#F08080','#FFA07A','#FFF68F','#FF8247','#FFBBFF','#FFFFFF','#CDB38B','#00FF00'],
                                label: {
                                    normal: {  //正常的样式
                                        show: true,
                                        position: 'left'
                                    },
                                    emphasis: { //选中时候的样式
                                        show: true,
                                        textStyle: {
                                            fontSize: '20',
                                            fontWeight: 'bold'
                                        }
                                    }
                                },  //提示文字
                                labelLine: {
                                    normal: {
                                        show: false
                                    }
                                },
                                data: alarmNumArr
                            }
                        ]
                    };
                    hzChartB.setOption(hzOptionB);
                }else if(res.code = 1001){
                    location.href = "../../login.html";
                }else{
                    layer.msg('后台异常',{
                        icon: 5
                    })
                }
            }
        })
    }

    //设置企业和车辆每天的数据
    function setCarTeamDay(param,startCountDate){
        $.ajax({
            type: 'POST',
            url: basePathUrl + '/admin/bigdataFenxiCarWeek/selectCarTeamDayByCarWeek.jsn',
            data: param,
            dataType: 'json',
            beforeSend: function (XMLHttpRequest) {
                XMLHttpRequest.setRequestHeader("access-token", getStorage("access_token"));
            },
            success:function(res){
                if(res.success){
                    var carDayRecList = res.data.carDayRecList;
                    var teamDayRecList = res.data.teamDayRecList;
                    var startDate = new Date(startCountDate);
                    //设置横坐标数据,折线图车辆数据
                    for(var i=0;i<carDayRecList.length;i++){
                        xDateArr[i] = dateFormat('yyyy-MM-dd',startDate);
                        startDate.setDate(startDate.getDate() + 1);
                        startDate = new Date(startDate);
                        //设置里程分析数据车辆
                        carMileageArr[i] = carDayRecList[i].sumMileage;
                        //设置时长分析数据车辆
                        carTimeLengthArr[i] = carDayRecList[i].sumDuration;
                        //设置报警数量数据车辆
                        carAlarmNumArr[i] = carDayRecList[i].alarmNum;
                        //设置里程分析数据企业
                        teamMileageArr[i] = teamDayRecList[i].runMileage;
                        //设置时长分析数据企业
                        teamTimeLengthArr[i] = teamDayRecList[i].runTimeLength;
                        //设置报警数量数据企业
                        teamAlarmNumArr[i] = teamDayRecList[i].alarmNum;
                    }
                    //设置图标显示
                    setChartInit();
                }else if(res.code = 1001){
                    location.href = "../../login.html";
                }else{
                    layer.msg('后台异常',{
                        icon: 5
                    })
                }
            }
        })
    }

    //设置企业和车辆每天的数据 月份
    function setCarTeamDayMonth(param,yearNum,countMonth){
        debugger;
        $.ajax({
            type: 'POST',
            url: basePathUrl + '/admin/bigdataFenxiCarMonth/selectCarTeamDayByCarMonth.jsn',
            data: param,
            dataType: 'json',
            beforeSend: function (XMLHttpRequest) {
                XMLHttpRequest.setRequestHeader("access-token", getStorage("access_token"));
            },
            success:function(res){
                if(res.success){
                    var carDayRecList = res.data.carDayRecList;
                    var teamDayList = res.data.teamDayRecList;
                    var countMonthStr = countMonth+"";
                    var countMonthArr = countMonthStr.split(yearNum+"");
                    var monthInt = parseInt(countMonthArr[1]);
                    var startDate = new Date(yearNum,monthInt-1,1);

                    debugger;
                    //设置横坐标数据,折线图车辆数据
                    for(var i=0;i<carDayRecList.length;i++){
                        xDateArr[i] = dateFormat('yyyy-MM-dd',startDate);
                        startDate.setDate(startDate.getDate() + 1);
                        startDate = new Date(startDate);
                        //设置里程分析数据车辆
                        carMileageArr[i] = carDayRecList[i].sumMileage;
                        //设置时长分析数据车辆
                        carTimeLengthArr[i] = carDayRecList[i].sumDuration;
                        //设置报警数量数据车辆
                        carAlarmNumArr[i] = carDayRecList[i].alarmNum;
                        if(typeof(teamDayList) == 'undefined'){
                            //设置里程分析数据企业
                            teamMileageArr[i] = 0;
                            //设置时长分析数据企业
                            teamTimeLengthArr[i] = 0;
                            //设置报警数量数据企业
                            teamAlarmNumArr[i] = 0;
                        }else{
                            //设置里程分析数据企业
                            teamMileageArr[i] = teamDayList[i].runMileage;
                            //设置时长分析数据企业
                            teamTimeLengthArr[i] = teamDayList[i].runTimeLength;
                            //设置报警数量数据企业
                            teamAlarmNumArr[i] = teamDayList[i].alarmNum;
                        }
                    }
                    //设置图表信息
                    setChartInit();
                }else if(res.code = 1001){
                    location.href = "../../login.html";
                }else{
                    layer.msg('后台异常',{
                        icon: 5
                    })
                }
            }
        })
    }

    //设置图表
    function setChartInit(){
        //行驶里程
        var mileageChart = echarts.init(document.getElementById('runMileageChart'));
        var mileageOption = {
            tooltip: {
                trigger: 'axis'
            },
            color: ['#87CEFA','#FF8247'],
            legend: {
                data:['行驶里程','公司平均'],
                textStyle:{
                    color:'#77eaff'
                }
            },
            xAxis: {
                type: 'category',
                boundaryGap: false,
                axisLabel: {
                    show: true,
                    textStyle:{
                        color:'#77eaff'
                    }
                },
                splitLine: {
                    show: false
                },
                data: xDateArr,
            },
            yAxis: {
                type: 'value',
                axisLabel: {
                    show: true,
                    textStyle:{
                        color:'#77eaff'
                    }
                },
                splitLine: {
                    show: true,
                    lineStyle:{
                        color: ['gray'],
                        width: 1,
                        type: 'dashed'
                    }
                }
            },
            series: [
                {
                    name:'行驶里程',
                    type:'line',
                    data: carMileageArr
                },
                {
                    name:'公司平均',
                    type:'line',
                    data: teamMileageArr
                }
            ]
        };
        mileageChart.setOption(mileageOption);
        //行驶时长
        var timeLongChart = echarts.init(document.getElementById('runTimeChart'));
        var timeLengthOption = {
            tooltip: {
                trigger: 'axis'
            },
            color: ['#87CEFA','#FF8247'],
            legend: {
                data:['行驶时长','公司平均'],
                textStyle:{
                    color:'#77eaff'
                }
            },
            xAxis: {
                type: 'category',
                boundaryGap: false,
                axisLabel: {
                    show: true,
                    textStyle:{
                        color:'#77eaff'
                    }
                },
                splitLine: {
                    show: false
                },
                data: xDateArr,
            },
            yAxis: {
                type: 'value',
                axisLabel: {
                    show: true,
                    textStyle:{
                        color:'#77eaff'
                    }
                },
                splitLine: {
                    show: true,
                    lineStyle:{
                        color: ['gray'],
                        width: 1,
                        type: 'dashed'
                    }
                }
            },
            series: [
                {
                    name:'行驶时长',
                    type:'line',
                    data: carTimeLengthArr
                },
                {
                    name:'公司平均',
                    type:'line',
                    data: teamTimeLengthArr
                }
            ]
        };
        timeLongChart.setOption(timeLengthOption);
        //报警统计
        var alarmChart = echarts.init(document.getElementById('alarmChart'));
        var alarmOption = {
            tooltip: {
                trigger: 'axis'
            },
            color: ['#87CEFA','#FF8247'],
            legend: {
                data:['报警数量','公司平均'],
                textStyle:{
                    color:'#77eaff'
                }
            },
            xAxis: {
                type: 'category',
                boundaryGap: false,
                axisLabel: {
                    show: true,
                    textStyle:{
                        color:'#77eaff'
                    }
                },
                splitLine: {
                    show: false
                },
                data: xDateArr,
            },
            yAxis: {
                type: 'value',
                axisLabel: {
                    show: true,
                    textStyle:{
                        color:'#77eaff'
                    }
                },
                splitLine: {
                    show: true,
                    lineStyle:{
                        color: ['gray'],
                        width: 1,
                        type: 'dashed'
                    }
                }
            },
            series: [
                {
                    name:'报警数量',
                    type:'line',
                    data: carAlarmNumArr
                },
                {
                    name:'公司平均',
                    type:'line',
                    data: teamAlarmNumArr
                }
            ]
        };
        alarmChart.setOption(alarmOption);
    }

    function goShouYe() {
        window.location.href = "shouye.html";
    }
</script>


</body>
</html>
