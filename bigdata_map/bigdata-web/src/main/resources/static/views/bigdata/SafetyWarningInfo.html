<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>秦皇岛市智慧交通北斗大数据分析平台</title>
<link href="css/animate.min.css" rel="stylesheet" type="text/css">
<link href="css/layout.css" rel="stylesheet" type="text/css" />
<link href="css/bootstrap.min.css" rel="stylesheet">
<link href="font/iconfont.css" rel="stylesheet" type="text/css" />
<link rel="stylesheet" type="text/css" href="css/datedropper.css">
<link rel="stylesheet" type="text/css" href="css/timedropper.min.css">
    
<script src="js/jquery-1.8.3.min.js"></script>
<script src="js/echarts.min.js"></script>
    <script type="text/javascript" src="js/laydate/laydate.js"></script>
    <script src="js/layer/layer.js"></script>

    <script src="js/tool.js"></script>
</head>

<body>

<div class="top" >
    <div class="top_r">
        <div class="time">
                
                   
               <!-- <input type="text" class="input_rl " id="pickdate" style="width:150px; height: 48px; margin-right: 10px; " /> -->
            <!--<input type="text" class="input_rl " id="searchDate" style="width:150px; height: 48px; margin-right: 10px; ">-->
				<span id=localtime></span>
                <script type="text/javascript">
					function showLocale(objD){
						var str,colorhead,colorfoot;
						var yy = objD.getYear();
						if(yy<1900) yy = yy+1900;
						var MM = objD.getMonth()+1;
						if(MM<10) MM = '0' + MM;
						var dd = objD.getDate();
						if(dd<10) dd = '0' + dd;
						var hh = objD.getHours();
						if(hh<10) hh = '0' + hh;
						var mm = objD.getMinutes();
						if(mm<10) mm = '0' + mm;
						var ss = objD.getSeconds();
						if(ss<10) ss = '0' + ss;
						var ww = objD.getDay();
						if  ( ww==0 )  colorhead="<font color=\"#35afbd\">";
						if  ( ww > 0 && ww < 6 )  colorhead="<font color=\"#35afbd\">";
						if  ( ww==6 )  colorhead="<font color=\"#35afbd\">";
						if  (ww==0)  ww="星期日";
						if  (ww==1)  ww="星期一";
						if  (ww==2)  ww="星期二";
						if  (ww==3)  ww="星期三";
						if  (ww==4)  ww="星期四";
						if  (ww==5)  ww="星期五";
						if  (ww==6)  ww="星期六";
						colorfoot="</font>"
						str = colorhead + yy + "-" + MM + "-" + dd + " " + hh + ":" + mm + ":" + ss + "  " + ww + colorfoot;
						return(str);
					}
					
					function tick(){
						var today;
						today = new Date();
						document.getElementById("localtime").innerHTML = showLocale(today);
						window.setTimeout("tick()", 1000);
					}
					
					tick();
					</script>	
        </div>
    </div>
    <div class="top_l">
    
        <div class="bt">
             <div class="bt_name left">主动安全预警</div>
             <a href="shouye.html" class="fanhui"><i class="iconfont icon-fanhui"></i></a>
        </div>
      
    </div>

    <div class="top_m "><div class="logo" onclick="goShouYe();"style="cursor:pointer">秦皇岛市智慧交通北斗大数据分析平台</div></div>
</div>




<div class="main">
      <div class="ind">
                 
         
              <Div class="blank40"></Div>
          
             <div class="mk" style="position: relative ;  height:900px">
                <em class="b1"></em><em class="b2"></em><em class="b3"></em><em class="b4"></em><em class="mid"></em>
                 <div class="blank20"></div>
              <!--  <div class="tit">
                     <span class="tit_l"></span>
                     <span class="tit_m">运力分析详情</span>
                     <span class="tit_r"></span>
                </div>
-->


                 <div style="margin-left: 25px;">
                     <div class="mingcheng0" style="display: inline-block;padding-right: 5px;    padding-top: 9px;">车牌号:</div>
                     <input type="text" class="input00" id="carPlateNum" style="width:150px; height: 48px; margin-right: 10px; ">
                     <div class="mingcheng0" style="display: inline-block;padding-right: 5px;    padding-top: 9px;">车辆类型:</div>
                     <select  id="carType" name="carType" class="input00" style="width: 5%;height: 50px;margin-right: 40px;">
                         <option class="lsd" value ="">全部</option>
                         <option class="lsd" value ="普货">普货</option>
                         <option class="lsd" value ="客运">客运</option>
                         <option class="lsd" value ="危货">危货</option>
                     </select>
                     <div class="mingcheng0" style="display: inline-block;padding-right: 5px;    padding-top: 9px;">企业名:</div>
                     <input type="text" class="input00" id="teamName" style="width:150px; height: 48px; margin-right: 10px; ">
                     <div class="mingcheng0" style="display: inline-block;padding-right: 5px;    padding-top: 9px;">运营商:</div>
                     <input type="text" class="input00" id="compName" style="width:150px; height: 48px; margin-right: 10px; ">
                     <div class="mingcheng0" style="display: inline-block;padding-right: 5px;    padding-top: 9px;">报警级别:</div>
                     <select  id="warningLevel" name="warningLevel" class="input00" style="width: 5%;height: 50px;margin-right: 40px;">
                         <option class="lsd" value ="">全部</option>
                         <option class="lsd" value ="1">1</option>
                         <option class="lsd" value ="2">2</option>
                     </select>
                     <div class="mingcheng0" style="display: inline-block;padding-right: 5px;    padding-top: 9px;">处理状态:</div>
                     <select  id="handleState" name="handleState" class="input00" style="width: 5%;height: 50px;margin-right: 40px;">
                         <option class="lsd" value ="">全部</option>
                         <option class="lsd" value ="已处理">已处理</option>
                         <option class="lsd" value ="未处理">未处理</option>
                     </select>
                     <div class="mingcheng0" style="display: inline-block;padding-right: 5px;    padding-top: 9px;">日期:</div>
                     <input type="text" class="input_rl " id="searchDate" style="width:150px; height: 48px; margin-right: 10px; ">
                        <a style="" href="javaScript:void(0);" class="chaxun" onclick="searchInfo()">搜索</a>
                 </div>
                 <div class="blank20"></div>

                 <div class="con0 clearfix" >
                              <table width="100%" class="grid06" id="teamAnalysisInfo">
                                  <!--<tr>
                                    <th style="width:5%">序号</th>
                                    <th style="width:8%">运营商名称</th>
                                    <th style="width:8%">在网车辆总数</th>
                                    <th style="width:8%">上传时间</th>
                                    <th style="width:8%">上传数</th>
                                    <th style="width:8%">上传率</th>
                                    <th style="width:8%">丢包数</th>
                                    <th style="width:8%">丢包率</th>
                                    <th style="width:8%">接收数</th>
                                    <th style="width:8%">接收率</th>
                                    <th style="width:8%">合格数</th>
                                    <th style="width:8%">合格率</th>
                                  </tr>
                                  <tr>
                                    <td>1</td>
                                    <td>中交兴路</td>
                                    <td class="bg_ys5">50000</td>
                                    <td>2018-08-08</td>
                                    <td class="bg_ys5">40000</td>
                                    <td>80%</td>
                                    <td class="bg_ys5">4000</td>
                                    <td>10%</td>
                                    <td class="bg_ys5">36000</td>
                                    <td>72%</td>
                                    <td class="bg_ys5">32000</td>
                                    <td>80%</td>
                                  </tr>
                                  <tr>
                                    <td>2</td>
                                    <td>中交兴路</td>
                                    <td class="bg_ys5">50000</td>
                                    <td>2018-08-08</td>
                                    <td class="bg_ys5">40000</td>
                                    <td>80%</td>
                                    <td class="bg_ys5">4000</td>
                                    <td>10%</td>
                                    <td class="bg_ys5">36000</td>
                                    <td>72%</td>
                                    <td class="bg_ys5">32000</td>
                                    <td>80%</td>
                                  </tr>
                                  <tr>
                                    <td>3</td>
                                    <td>中交兴路</td>
                                    <td class="bg_ys5">50000</td>
                                    <td>2018-08-08</td>
                                    <td class="bg_ys5">40000</td>
                                    <td>80%</td>
                                    <td class="bg_ys5">4000</td>
                                    <td>10%</td>
                                    <td class="bg_ys5">36000</td>
                                    <td>72%</td>
                                    <td class="bg_ys5">32000</td>
                                    <td>80%</td>
                                  </tr>
                                  <tr>
                                    <td>4</td>
                                    <td>中交兴路</td>
                                    <td class="bg_ys5">50000</td>
                                    <td>2018-08-08</td>
                                    <td class="bg_ys5">40000</td>
                                    <td>80%</td>
                                    <td class="bg_ys5">4000</td>
                                    <td>10%</td>
                                    <td class="bg_ys5">36000</td>
                                    <td>72%</td>
                                    <td class="bg_ys5">32000</td>
                                    <td>80%</td>
                                  </tr>
                                  <tr>
                                    <td>1</td>
                                    <td>中交兴路</td>
                                    <td class="bg_ys5">50000</td>
                                    <td>2018-08-08</td>
                                    <td class="bg_ys5">40000</td>
                                    <td>80%</td>
                                    <td class="bg_ys5">4000</td>
                                    <td>10%</td>
                                    <td class="bg_ys5">36000</td>
                                    <td>72%</td>
                                    <td class="bg_ys5">32000</td>
                                    <td>80%</td>
                                  </tr>-->
                               </table>
                </div>

                 <div class="blank20"></div>


                 <div id="pageList" class="green-black">
                     <!--<span class="disabled">&lt; Prev</span>
                     <span class="current">1</span>
                     <a href="#?page=2">2</a>
                     <a href="#?page=3">3</a>
                     <a href="#?page=4">4</a>
                     <a href="#?page=5">5</a>
                     <a href="#?page=6">6</a>
                     <a href="#?page=7">7</a><em class="white">......</em>
                     <a href="#?page=199">199</a>
                     <a href="#?page=200">200</a>
                     <a href="#?page=2">Next
                     &gt; </a>-->
                 </div>
             </div>
             
      
      </div> 
</div>
<div id="con2" style="display:none">
</div>







<script src="js/jquery-migrate-1.2.1.min.js"></script>
<script src="js/echarts.min.js"></script>
<script src="js/datedropper.min.js"></script>
<script src="js/timedropper.min.js"></script>
<script>
$("#pickdate").dateDropper({
	animate: false,
	format: 'Y-m-d',
	maxYear: '2020'
});

</script>
<script type="text/javascript">

    var searchDate = "";
    //初始化数据
    $(document).ready(function(){
        //获取参数
        var queryArgs = getQueryParam();
        var carPlateNum = $("#carPlateNum").val();
        queryArgs.carPlateNum = carPlateNum;
        //初始化日期
        initLayDate(queryArgs.searchTime);
        searchDate = queryArgs.searchTime;
        SafetyWarningDetail(queryArgs)
    });

    //初始化日期
    function initLayDate(searchTime) {
        laydate.render({
            elem: '#searchDate',
            theme: '#884898',
            value: searchTime,
            btns: ['confirm'],
            done: function(value, date, endDate){
                if(value!=""){
                    var queryArgs = getQueryParam();
                    queryArgs.searchTime = value;
                    searchDate = value;
                }
            }
        });
    }
    //城市运力详情
    function SafetyWarningDetail(queryArgs) {
        //北斗数据接入详情
        var yearNum = queryArgs.searchTime.substring(0,4);
        var month = queryArgs.searchTime.substring(5,7);
        var date = queryArgs.searchTime.substring(8,10);
        var countMonth = yearNum+month;
        var countDate = yearNum + month +date;
        //车牌号
        var carPlateNum = $("#carPlateNum").val();
        //车辆类型
        var carType = $("#carType").val();
        //企业名
        var teamName = $("#teamName").val();
        //运营商
        var compName = $("#compName").val();
        //报警级别
        var warningLevel = $("#warningLevel").val();
        //处理状态
        var handleState = $("#handleState").val();
        $.ajax({
            type: "POST",
            url: basePathUrl+"/admin/bigdataSafetyWarning/qtlistpage.jsn",
            data: {'queryObj.countDate':countDate,
                'queryObj.countMonth':countMonth,
                'queryObj.uploadTime':queryArgs.searchTime,
                'queryObj.carPlateNum':carPlateNum,
                'queryObj.carType':carType,
                'queryObj.ownerTeamName':teamName,
                'queryObj.compName':compName,
                'queryObj.warningLevel':warningLevel,
                'queryObj.handleState':handleState,
                "page":queryArgs.page,
                "limit":queryArgs.limit
            },
            dataType: "json",
            beforeSend: function (XMLHttpRequest) {
                XMLHttpRequest.setRequestHeader("access-token", getStorage("access_token"));
            },
            success: function(data){
                var start = data.start;
                var safetyWarningList = data.list;
                if(data.success){
                    var html = " <tr>\n" +
                        "                                    <th style=\"width:4%\">序号</th>\n" +
                        "                                    <th style=\"width:6%\">车牌号</th>\n" +
                        "                                    <th style=\"width:5%\">车牌颜色</th>\n" +
                        "                                    <th style=\"width:5%\">车辆类型</th>\n" +
                        "                                    <th style=\"width:15%\">企业名</th>\n" +
                        "                                    <th style=\"width:8%\">运营商</th>\n" +
                        "                                    <th style=\"width:8%\">上传时间</th>\n" +
                        "                                    <th style=\"width:8%\">报警类型</th>\n" +
                        "                                    <th style=\"width:5%\">报警级别</th>\n" +
                        "                                    <th style=\"width:5%\">处理</th>\n" +
                        "                                  </tr>\n" ;

                    if(safetyWarningList!=null){
                        for(var i =0 ;i<safetyWarningList.length;i++){
                            html +="                                  <tr>\n" +
                                "                                    <td>"+(start+i+1)+"</td>\n" +
                                "                                    <td><a href='javaScript:void(0)' onclick=gotoYingYunCL('"+safetyWarningList[i].carPlateNum+"')>"+safetyWarningList[i].carPlateNum+"</a></td>\n" +
                                "                                    <td class=\"bg_ys5\">"+safetyWarningList[i].carPlateColorText+"</td>\n" +
                                "                                    <td>"+safetyWarningList[i].carType+"</td>\n" +
                                "                                    <td class=\"bg_ys5\"><a href='javaScript:void(0)' onclick=gotoYunShuYeHu('"+safetyWarningList[i].ownerTeamId+"')>"+safetyWarningList[i].ownerTeamName+"</td>\n" +
                                "                                    <td>"+safetyWarningList[i].compName+"</td>\n" +
                                "                                    <td class=\"bg_ys5\">"+safetyWarningList[i].uploadTime+"</td>\n" +
                                "<td onclick='safetyWarningFile(\""+safetyWarningList[i].id+"\",\"" + safetyWarningList[i].warningType + "\",\""+safetyWarningList[i].carPlateNum+"\",\""+queryArgs.searchTime+"\")'><a href='javaScript:void(0)'>"+safetyWarningList[i].warningType+"</a></td>\n" +
                                "                                    <td class=\"bg_ys5\">"+safetyWarningList[i].warningLevel+"</td>\n" +
                                "                                     <td >"+safetyWarningList[i].handleState+"</td>\n" +
                                "                                  </tr>";
                        }
                        $("#teamAnalysisInfo").html(html);
                        setPageInfo(data.totalPage,data.start,data.limit);
                    }
                }else {
                    if(data.code==1001){
                        location.href = '../../login.html';
                    }else {
                        layer.msg('后台异常', {
                            icon: 5
                        });
                    }
                }
            }
        });
    }
    function safetyWarningFile(id,warningType,carPlateNum,searchTime) {
        var year = searchTime.substring(0,4);
        var month = searchTime.substring(5,7);
        var day = searchTime.substring(8,10);
        var countDate = year+month+day;
        var countMonth = year+month;
        $.ajax({
            type:'POST',
            url:basePathUrl + "/admin/bigdataSafetyWarningFile/selectWarningFile.jsn",
            data:{"queryObj.ownerSafetyWarningId":id,"queryObj.countDate":countDate,
                "queryObj.countMonth":countMonth},
            beforeSend: function (XMLHttpRequest) {
                XMLHttpRequest.setRequestHeader("access-token", getStorage("access_token"));
            },
            success:function(data){
                if(data.success){
                    var safetyWarningFileList = data.list;
                    var html = "";
                    $("#con2").html("");

                    if(safetyWarningFileList.length > 0){

                        for(var i=0;i<safetyWarningFileList.length;i++){
                            if(safetyWarningFileList[i].fileType == "picture"){
                                html += "<div class='warningFile'>";
                                html += "<img class='warningImg' src='"+safetyWarningFileList[i].fileUrl+"'/>";
                                html += "<p style='text-align: center'>图片证据</p>";
                                html += "</div>";
                            }else{
                                html += "<div class='warningFile'>";
                                html += "<video class='warningImg' controls='controls' autoplay='autoplay' src='"+safetyWarningFileList[i].fileUrl+"'></video>";
                                html += "<p style='text-align: center'>视频证据</p>";
                                html += "</div>";
                            }
                        }
                        $("#con2").html($("#con2").html() + html);
                        layer.open({
                            type: 1,
                            title:false,
                            closeBtn: 0,
                            shadeClose: true,
//                            skin: 'win-bg',
                            area : ['1000px' , '800px'],
                            content:$('#con2')
                        });
                    }else{
                        html += "<h3 style='text-align: center'>"+carPlateNum+"&nbsp;&nbsp;&nbsp;&nbsp;"+warningType+"</h3>";
                        html += "<div >";
                        html += "<p style='text-align: center;font-size: 23px;'>无证据附件</p>";
                        html += "</div>";
                        $("#con2").html($("#con2").html() + html);
                        layer.open({
                            type: 1,
                            title:false,
                            closeBtn: 0,
                            shadeClose: true,
                            skin: 'win-bg',
                            area : ['1000px' , '250px'],
                            content:$('#con2')
                        });
                    }
                }else{
                    if(data.code==1001){
                        location.href = '../../login.html';
                    }else {
                        layer.msg('后台异常', {
                            icon: 5
                        });
                    }
                }
            }
        });


    }

    function setPageInfo(totalPage,start,limit){
        var page = 0;
        if(limit != 0){
            page = start/limit;
        }
        var pageHtml = "";
        var showPageCount = page + 5;
        pageHtml += "<a href='javaScript:void(0);' onclick=sendRequest('prev',"+(page+1)+","+totalPage+")>&lt;上一页</a>";
        if(page>0){
            pageHtml += "<a href='javaScript:void(0);' onclick=sendRequest('',"+(1)+","+totalPage+")>首页</a>";
        }
        for(var i=page;i<totalPage;i++){
            if(i < showPageCount){
                if(i == page){
                    pageHtml += "<a href='javaScript:void(0);' style='background-color: #E07C24;border: none'  onclick=sendRequest('',"+(i+1)+","+totalPage+")>"+(i+1)+"</a>";
                }else{
                    pageHtml += "<a href='javaScript:void(0);' onclick=sendRequest('',"+(i+1)+","+totalPage+")>"+(i+1)+"</a>";
                }
            }else{
                if(i == showPageCount){
                    pageHtml += "<em class='white'>......</em>";
                    pageHtml += "<a href='javaScript:void(0);' onclick=sendRequest('',"+totalPage+","+totalPage+")>"+totalPage+"</a>";
                }
            }
        }
        pageHtml += "<a href='javaScript:void(0);' onclick=sendRequest('next',"+(page+1)+","+totalPage+")>下一页 &gt;</a>";
        $("#pageList").html(pageHtml);
    }
    function sendRequest(pageFlag,page,totalPage){
        if(pageFlag == "next"){
            page++;
        }else{
            if(pageFlag == "prev"){
                page--;
            }
        }

        if(page > 0 && page <= totalPage){
            //初始化日期
            var param = {
                'searchTime':searchDate,
                'page':page,
                'limit':13
            }
            SafetyWarningDetail(param)
        }
    }
    function searchInfo() {
        //获取参数
        var carPlateNum = $("#carPlateNum").val();
        var queryArgs = getQueryParam();
        queryArgs.carPlateNum = carPlateNum;
        //初始化日期
        queryArgs.searchTime =searchDate;
        SafetyWarningDetail(queryArgs)
    }
    function goBack() {
        var queryArgs = getQueryParam();
        //初始化日期
        var searchTime = queryArgs.searchTime;
        window.location.href="CityAnalysisInfo.html?searchTime="+searchTime+"&carType="+encodeURI('总');;
    }
    function goShouYe() {
        window.location.href = "shouye.html";
    }
    function gotoYingYunCL(carPlateNum){
        window.parent.location.href = "yingYunCheLiang.html?queryObj.carPlateNum="+carPlateNum;
    }
    function gotoYunShuYeHu(teamId){
        window.location.href = "yunShuYeHu.html?teamId="+teamId;
    }
</script>



  
</body>
</html>
